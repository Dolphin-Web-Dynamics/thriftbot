<div class="flex justify-between items-center mb-6">
  <h1 class="text-2xl font-bold text-gray-900">CSV Imports</h1>
  <%= link_to "New Import", new_csv_import_path, class: "bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-indigo-700" %>
</div>

<div class="bg-white shadow rounded-lg overflow-hidden">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Filename</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Records</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Imported At</th>
        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% if @csv_imports.any? %>
        <% @csv_imports.each do |csv_import| %>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              <%= csv_import.filename %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= csv_import.records_count %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <% status_classes = {
                "pending" => "bg-yellow-100 text-yellow-800",
                "processing" => "bg-blue-100 text-blue-800",
                "completed" => "bg-green-100 text-green-800",
                "failed" => "bg-red-100 text-red-800"
              } %>
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <%= status_classes[csv_import.status] %>">
                <%= csv_import.status.capitalize %>
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              <%= csv_import.created_at.strftime("%b %d, %Y %I:%M %p") %>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
              <% if csv_import.error_log.present? %>
                <button onclick="document.getElementById('errors-<%= csv_import.id %>').classList.toggle('hidden')" class="text-yellow-600 hover:text-yellow-900 mr-3">
                  View Errors
                </button>
              <% end %>
              <%= button_to "Delete Import", csv_import_path(csv_import), method: :delete, class: "text-red-600 hover:text-red-900 font-medium", data: { turbo_confirm: "This will delete the import and ALL #{csv_import.records_count} items (including their listings and sales). Are you sure?" } %>
            </td>
          </tr>
          <% if csv_import.error_log.present? %>
            <tr id="errors-<%= csv_import.id %>" class="hidden">
              <td colspan="5" class="px-6 py-4 bg-red-50">
                <pre class="text-xs text-red-700 whitespace-pre-wrap"><%= csv_import.error_log %></pre>
              </td>
            </tr>
          <% end %>
        <% end %>
      <% else %>
        <tr>
          <td colspan="5" class="px-6 py-8 text-center text-sm text-gray-500">
            No imports yet. <%= link_to "Upload a CSV", new_csv_import_path, class: "text-indigo-600 hover:text-indigo-500 font-medium" %> to get started.
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
